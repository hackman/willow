<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<title> Willow network tools </title>

<style>
body { background: #fff; font-family: Tahoma, Verdana, Arial; font-size: 12px; padding: 0; margin: 0; color: #000; }
#header {
	margin: 0;
	padding: 0;
	height: 40px;
	width: 100%;
	text-align: center;
	vertical-align: middle;
	background-image: radial-gradient( circle 465px at -15.1% -25%,  rgba(17,130,193,1) 0%, rgba(67,166,238,1) 49%, rgba(126,203,244,1) 90.2% );
}
input, select {
  -webkit-border-radius: 4px;
     -moz-border-radius: 4px;
          border-radius: 4px;
}
#header h2 {
	margin: 0;
	padding-top: 8px;
	color: #fff;
	text-shadow: 2px 2px 4px #8585ad;
}
#ip, #ip-text {
	display: block;
	float: left;
	padding: 10px 0 0 10px;
	color: #fff;
	text-shadow: 2px 2px 4px #8585ad;
}
#tools {
	margin: 0;
	text-align: left;
	padding-top: 10px;
	padding-left: 25%;
	padding-bottom: 10px;
	background-color: #c2c2d6;
	border-bottom: 1px solid gray;
}
#protos {
	margin: 0;
	text-align: left;
	padding-top: 10px;
	padding-left: 25%;
	padding-bottom: 10px;
	background-color: #c2c2d6;
	display: none;
}
#results {
	width: 100%;
	text-align: left;
}
#results .progress {
	display: block;
	margin-left: auto;
	margin-right: auto;
	width: 50%;
}
#results pre {
	padding-left: 5px;
}

#copy img {
	float: left;
	margin-top: 6px;
	margin-left: 5px;
}

.gh-link {
	position: fixed; top: 12px; right: 12px; z-index: 9990;
	display: inline-flex; align-items: center; gap: 8px;
	padding: 8px 10px; border-radius: 999px;
	background: rgba(255,255,255,0.35);
	color: #1781da;
	border: 1px solid rgba(255,255,255,0.16);
	text-decoration: none;
	font: 500 13px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
	backdrop-filter: blur(4px);
	-webkit-tap-highlight-color: transparent;
}
.gh-link:hover { background: rgba(255,255,255,0.35); border-color: rgba(255,255,255,0.55); font-weight: bold; }
.gh-link svg { width: 18px; height: 18px; fill: currentColor; }
@media (prefers-color-scheme: light) {
	.gh-link {
		background: rgba(0,0,0,0.05); color: #111827;
		border-color: rgba(0,0,0,0.12);
	}
	.gh-link:hover{ background: rgba(0,0,0,0.10); }
}


/* Fancy Loading Screen */
.wlw-hidden { display: none !important; }
#wlw-loader {
	position: fixed; inset: 0; z-index: 9999;
	display: grid; place-items: center;
	background:
		radial-gradient(1200px 800px at 20% 10%, rgba(100,200,255,.10), transparent 60%),
		radial-gradient(1000px 600px at 80% 90%, rgba(180,120,255,.10), transparent 60%),
		rgba(13,17,23,.85);
	backdrop-filter: blur(3px);
	color: #e6edf3;
}
#wlw-loader[aria-hidden="true"] { display: none; }
.wlw-card {
	width: min(640px, 92vw);
	border-radius: 28px;
	padding: 28px 28px 24px;
	background: rgba(255,255,255,.035);
	box-shadow: 0 10px 40px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
	border: 1px solid rgba(255,255,255,.08);
}
.wlw-head {
	display: flex; align-items: center; gap: 16px; margin-bottom: 10px;
}
/* spinner */
.wlw-spin {
	width: 28px; height: 28px; border-radius: 999px;
	border: 3px solid rgba(255,255,255,.18);
	border-top-color: rgba(255,255,255,.9);
	animation: wlw-rot 1s linear infinite;
	flex: 0 0 auto;
}
@keyframes wlw-rot { to { transform: rotate(360deg); } }
/* “Willow” wordmark with shimmer */
.wlw-title {
	font: 700 26px/1.1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
	letter-spacing: .3px;
	background: linear-gradient(92deg, #c3e7ff, #ffffff, #d5c2ff);
	background-size: 200% 100%;
	-webkit-background-clip: text; background-clip: text; color: transparent;
	animation: wlw-shimmer 2.6s ease-in-out infinite;
}
@keyframes wlw-shimmer {
	0% { background-position: 0% 50%; }
	50% { background-position: 100% 50%; }
	100% { background-position: 0% 50%; }
}
.wlw-subtle { color: #9da7b3; font-size: 14px; }
.wlw-body { margin-top: 10px; }
.wlw-pulse { animation: wlw-pulse 1.8s ease-in-out infinite; }
@keyframes wlw-pulse {
	0%,100% { opacity: .55; }
	50% { opacity: 1; }
}
.wlw-hints {
	margin-top: 14px; border-top: 1px dashed rgba(255,255,255,.12);
	padding-top: 14px; display: flex; align-items: center; gap: 10px;
	min-height: 28px;
}
.wlw-dot {
	width: 8px; height: 8px; border-radius: 999px;
	background: rgba(133, 212, 255, .9);
	box-shadow: 0 0 12px rgba(133, 212, 255, .8);
	animation: wlw-bounce 1.6s ease-in-out infinite;
}
@keyframes wlw-bounce {
	0%,100% { transform: translateY(0); }
	50% { transform: translateY(-3px); }
}
.wlw-hint-text {
	font-size: 15px; color: #c7d1dc;
	white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
/* Respect users that prefer less motion */
@media (prefers-reduced-motion: reduce) {
	.wlw-spin, .wlw-title, .wlw-pulse, .wlw-dot { animation: none !important; }
}

#wlw-loader { position: fixed; inset: 0; z-index: 9999; display: grid; place-items: center; /* ...rest... */ }
#wlw-loader[aria-hidden="true"] { display: none; } /* hide only via aria-hidden */

</style>

<script src="//code.jquery.com/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
var url = "api.pl?";

function get_ip() {
	$.ajax({
        'async': false,
        'global': false,
        'url': url,
		'data': { cmd: 'ip' },
        'dataType': 'html',
        'success': function (data) {
			$('#ip').html('<b>' + data + '</b');
			$('#host').val(data);
			$('#hostp').val(data);
        }
	});
}

async function do_call(data) {
	$('#results').html('<pre></pre>');
	var host = data.host;
	host = host.replace(/https?:\/\//,'');
	host = host.replace(/\/.*/g,'');
	host = host.replace(/ */g,'');
	data.host = host;
	try {
		const tool = $('#tool').find(":selected").text();
		const params = new URLSearchParams(data).toString();
		const res = await withLoadingScreen(
			() => fetch(`${url}${params}`, { method: 'GET' }),
			{ start: `Running ${tool}…`, during: 'Rendering results…' }
		);

		const text = await res.text();
		$('#results').html('<pre>' + text + '</pre>');
	} catch (err) {
		$('#results').html('<pre>' + (err && err.message) ? err.message : 'Request failed' + '</pre>');
	}
}

function handle_net(event,key) {
	if (key && event.which != 13)
		return;
    event.preventDefault();
	host = $('#host').val();
	cmd  = $('#tool').val();
	if (host !== '') {
        do_call({ cmd: cmd, host: host });
	}
}

function handle_proto(event,key) {
	if (key && event.which != 13)
		return;
    event.preventDefault();
	host = $('#hostp').val();
	proto  = $('#proto').val();
	user = $('#user').val();
	pass = $('#pass').val();
	if (host !== '' && proto !== '' && user !== '' && pass !== '') {
        do_call({proto: proto, host: host, user: user, pass: pass});
	}
}

function copy_ip() {
	var temp = $('<input>');
	$('body').append(temp);
	temp.val($('#ip').text()).select();
	document.execCommand("copy");
	temp.remove();
}

function init_focus() {
	$('#host').focusout(function() { if ($('#host').val() === '') $('#host').val('IP or Host') });
	$('#host').focus(function() { $('#host').val('') });
}

$(document).ready(function(){
	init_focus();
	$('#host').on('keypress', function(e) { handle_net(e,1) });
	$('#tool').on('keypress', function(e) { handle_net(e,1) });
	$('#exec').on('click', function(e) { handle_net(e,0) });
	$('#execp').on('click', function(e) { handle_proto(e,0) });
	$('#ip').on('click', function(e) { do_call({ cmd: $('#tool').val(), host: $('#ip').text() }); });
	get_ip();
});

jQuery(function ($) {
	// Build once, expose globally
	const hints = [
		'Traceroute network paths...',
		'Get whois data',
		'Resolv DNS entries...',
		'Check connectivity using ping or mtr...'
	];

	const api = (function () {
	const $root = $('#wlw-loader');
	const $line = $('#wlw-loader-line');
	const $hint = $('#wlw-hint');
	let hintIdx = 0, rot = null;
	
	function show(msg = 'Working…') {
		if (!$root.length) { return; }
		$line.text(msg);
		$root.attr('aria-hidden', 'false'); // visible via CSS: #wlw-loader[aria-hidden="true"] { display:none }
		clearInterval(rot);
		hintIdx = Math.floor(Math.random() * hints.length);
		$hint.text(hints[hintIdx]);
		rot = setInterval(() => {
		  hintIdx = (hintIdx + 1) % hints.length;
		  $hint.text(hints[hintIdx]);
		}, 2000);
	}
	function message(msg) { $line.text(msg); }
	function hide() { clearInterval(rot); if ($root.length) $root.attr('aria-hidden', 'true'); }

	return { show, message, hide };
	})();

	// EXPOSE GLOBALLY
	window.WillowLoader = api;

	// Also expose wrapper globally
	window.withLoadingScreen = async function (promiseFactory, opts = {}) {
		const { start = 'Contacting API…', during = 'Processing response…' } = opts;
		window.WillowLoader.show(start);
		try {
			const res = await promiseFactory();
			window.WillowLoader.message(during);
			return res;
		} finally {
			setTimeout(() => window.WillowLoader.hide(), 250);
		}
	};
});

// Wrap any async call with loading screen
async function withLoadingScreen(promiseFactory, { start = 'Contacting API…', during = 'Processing response…' } = {}) {
	WillowLoader.show(start);
	try {
		const res = await promiseFactory();
		WillowLoader.message(during);
		return res;
	} finally {
		// hide after a slight delay so user sees "Rendering…" briefly
		setTimeout(() => WillowLoader.hide(), 250);
	}
}
</script>
</head>
<body>

<!-- Fancy Loading Screen -->
<div id="wlw-loader" role="status" aria-live="polite" aria-atomic="true" aria-hidden="true">
  <div class="wlw-card" aria-label="Loading">
    <div class="wlw-head">
      <div class="wlw-spin" aria-hidden="true"></div>
      <div class="wlw-title">Willow</div>
    </div>
    <div class="wlw-body">
      <div id="wlw-loader-line" class="wlw-subtle wlw-pulse">Preparing tools…</div>
      <div class="wlw-hints">
        <div class="wlw-dot" aria-hidden="true"></div>
        <div class="wlw-hint-text">You can use this tool to:</div>
        <div id="wlw-hint" class="wlw-hint-text">Running diagnostics…</div>
      </div>
    </div>
  </div>
</div>

<a class="gh-link" href="https://github.com/hackman/willow" target="_blank" rel="noopener noreferrer" aria-label="Open Willow on GitHub">
	<!-- GitHub mark -->
	<svg viewBox="0 0 16 16" aria-hidden="true" focusable="false">
	<path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2 .37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52
-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2 -3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18
1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2
0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
	</svg>
	<span>GitHub</span>
</a>

<div id=header>
	<div id=ip-text>Your IP address is: </div><div id=ip></div><a href='javascript:copy_ip()' id=copy><img src='img/clipboard.png' width=20></a>
<h2> Willow network tools </h2>
</div>
<div id=tools>
	<select id=tool>
		<option value=6>mtr</option>
		<option value=2>host</option>
		<option value=3>dig</option>
		<option value=4>whois</option>
		<option value=0>ping</option>
		<option value=1>traceroute</option>
		<option value=5>Name Servers</option>
	</select>
	<input type=text value='IP or Host' size=80 id=host>
	<input type=submit value='Execute' id=exec>
</div>
<div id=protos>
	<select id=proto>
		<option value=0>SMTP</option>
		<option value=1>POP3</option>
		<option value=2>POP3S</option>
		<option value=3>IMAP</option>
		<option value=4>IMAPS</option>
	</select>
	<input type=text value='IP or Host' size=50 id=hostp>
	<input type=text value='Username' size=20 id=user>
	<input type=text value='password' size=20 id=pass>
	<input type=submit value='Test' id=execp>
</div>
<div id=results>
</div>
</body>
</html>
